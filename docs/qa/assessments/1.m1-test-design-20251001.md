# Test Design: Story 1.M1 - Módulo BateriaRápida

Date: 2025-10-01
Reviewer: Quinn (Test Architect)

**Status**: PLANNING - Comprehensive test scenarios for first educational module

## Test Summary

- Total Test Scenarios: 48
- Unit Tests: 18 (38%)
- Integration Tests: 16 (33%)
- E2E Tests: 8 (17%)
- User Acceptance Tests: 6 (12%)

**Coverage**: All 3 ACs + DoD requirements + NFR targets + Risk mitigations

## Test Strategy

### Pyramid Distribution

```
        /\
       /  \  6 UAT (User Testing, Accessibility, BNCC)
      /____\
     /      \  8 E2E (Complete sessions, Analytics)
    /________\
   /          \  16 Integration (Feedback, Data flow, UI)
  /____________\
 /              \ 18 Unit (Algorithms, Validation, Performance)
```

### Risk-Based Prioritization

**P0 (Critical - 25 tests)**: Block release if failing
- Problem generation quality (EDU-001)
- Performance targets (PERF-001)
- Accessibility compliance (A11Y-001)
- BNCC alignment (DATA-002)
- Core functionality (AC-1, AC-2, AC-3)

**P1 (Important - 16 tests)**: Ship with known gaps, fix soon
- Advanced features (error patterns, difficulty curves)
- Edge cases (network failures, session recovery)
- Integration polish (feedback timing, analytics)

**P2 (Nice to Have - 7 tests)**: Future optimization
- A/B testing infrastructure
- Advanced analytics
- Configuration edge cases

## Unit Tests (18 scenarios)

### Group 1: Problem Generation Algorithms (EDU-001 mitigation)

**1.M1-UNIT-001: Addition Problem Generation**
- **Priority**: P0
- **Description**: Verify addition problems generated within configured range
- **Given**: Config with `operationType: "addition"`, `numberRange: { min: 10, max: 50 }`
- **When**: Generate 100 addition problems
- **Then**:
  - All operands between 10-50
  - Result doesn't exceed 100 (age-appropriate)
  - No duplicate problems in set
  - Problems distributed across range (not clustered)
- **Performance**: <10ms per problem
- **Risk Coverage**: EDU-001 (problem quality)

**1.M1-UNIT-002: Subtraction Problem Generation**
- **Priority**: P0
- **Description**: Verify subtraction generates non-negative results
- **Given**: Config with `operationType: "subtraction"`, `numberRange: { min: 10, max: 50 }`
- **When**: Generate 100 subtraction problems
- **Then**:
  - Minuend ≥ subtrahend (no negative results)
  - All operands between 10-50
  - Results between 0-40
  - No duplicate problems
- **Performance**: <10ms per problem
- **Risk Coverage**: EDU-001

**1.M1-UNIT-003: Multiplication Problem Generation**
- **Priority**: P0
- **Description**: Verify multiplication problems age-appropriate
- **Given**: Config with `operationType: "multiplication"`, `numberRange: { min: 2, max: 12 }`
- **When**: Generate 100 multiplication problems
- **Then**:
  - Factors between 2-12 (multiplication tables range)
  - Results don't exceed 144 (12×12)
  - Distribution across tables (not all 2× or 3×)
  - No duplicate problems
- **Performance**: <30ms per problem
- **Risk Coverage**: EDU-001, BNCC EF04MA07

**1.M1-UNIT-004: Division with Remainder Generation (CRITICAL)**
- **Priority**: P0
- **Description**: Verify division problems correctly handle remainders
- **Given**: Config with `operationType: "division"`, `numberRange: { min: 10, max: 100 }`
- **When**: Generate 100 division problems
- **Then**:
  - Mix of clean division (30%) and remainder (70%)
  - Remainders always < divisor (mathematical correctness)
  - Divisors typically 2-12 (age-appropriate)
  - Expected answer format: `{ quotient: 4, remainder: 3 }` or `"4 resto 3"`
  - No division by zero
  - No duplicate problems
- **Performance**: <50ms per problem
- **Risk Coverage**: EDU-001, BNCC EF05MA03
- **Example Problems**:
  ```javascript
  { dividend: 23, divisor: 5, expectedAnswer: { quotient: 4, remainder: 3 } }
  { dividend: 30, divisor: 6, expectedAnswer: { quotient: 5, remainder: 0 } }
  { dividend: 47, divisor: 7, expectedAnswer: { quotient: 6, remainder: 5 } }
  ```

**1.M1-UNIT-005: Problem Uniqueness Within Session**
- **Priority**: P0
- **Description**: Verify no duplicate problems in single session
- **Given**: Config with `quantity: 30`
- **When**: Generate 30 problems for session
- **Then**:
  - All 30 problems unique (no exact duplicates)
  - Check across all operations
  - Uniqueness persists if new problems generated (session pause/resume)
- **Implementation**: Use Set data structure for O(1) lookup
- **Risk Coverage**: EDU-001, UX-001 (engagement)

**1.M1-UNIT-006: Difficulty Curve - Flat**
- **Priority**: P1
- **Description**: Verify "flat" difficulty maintains consistent range
- **Given**: Config with `difficultyCurve: "flat"`, `numberRange: { min: 10, max: 50 }`
- **When**: Generate 30 problems
- **Then**:
  - All problems have operands within 10-50
  - Statistical distribution roughly uniform (±10%)
  - No progressive increase in difficulty
- **Risk Coverage**: EDU-001

**1.M1-UNIT-007: Difficulty Curve - Ascending**
- **Priority**: P1
- **Description**: Verify "ascending" difficulty progressively increases
- **Given**: Config with `difficultyCurve: "ascending"`, `numberRange: { min: 10, max: 100 }`
- **When**: Generate 30 problems
- **Then**:
  - First 10 problems: operands 10-40 (easier)
  - Middle 10 problems: operands 30-70 (medium)
  - Last 10 problems: operands 60-100 (harder)
  - Smooth progression (no sudden jumps)
- **Risk Coverage**: EDU-001, UX-001

**1.M1-UNIT-008: Difficulty Curve - Mixed**
- **Priority**: P2
- **Description**: Verify "mixed" difficulty varies unpredictably
- **Given**: Config with `difficultyCurve: "mixed"`, `numberRange: { min: 10, max: 100 }`
- **When**: Generate 30 problems
- **Then**:
  - Operands distributed across full 10-100 range
  - No predictable pattern (random)
  - Both easy and hard problems present throughout
- **Risk Coverage**: UX-001

### Group 2: Answer Validation Logic

**1.M1-UNIT-009: Correct Answer Validation - Exact Match**
- **Priority**: P0
- **Description**: Verify correct answers accepted
- **Given**: Problem "15 ÷ 3 = ?"
- **When**: User submits "5"
- **Then**: `isCorrect: true`
- **Risk Coverage**: Core functionality

**1.M1-UNIT-010: Correct Answer Validation - Division with Remainder**
- **Priority**: P0
- **Description**: Verify remainder answers accepted in multiple formats
- **Given**: Problem "17 ÷ 5 = ?" (expected: quotient 3, remainder 2)
- **When**: User submits "3 resto 2" OR "3 r 2" OR `{ quotient: 3, remainder: 2 }`
- **Then**: `isCorrect: true` for all formats
- **Risk Coverage**: EDU-001, BNCC EF05MA03

**1.M1-UNIT-011: Incorrect Answer Validation**
- **Priority**: P0
- **Description**: Verify incorrect answers rejected
- **Given**: Problem "15 ÷ 3 = ?"
- **When**: User submits "4"
- **Then**: `isCorrect: false`, correct answer shown: "5"
- **Risk Coverage**: Core functionality

**1.M1-UNIT-012: Answer Validation - Edge Cases**
- **Priority**: P1
- **Description**: Verify validation handles edge cases gracefully
- **Test Cases**:
  - Empty input → `isCorrect: false`, error message "Por favor, insira uma resposta"
  - Non-numeric input ("abc") → `isCorrect: false`, error "Resposta deve ser um número"
  - Negative number (when not valid) → `isCorrect: false`
  - Very large number (overflow) → `isCorrect: false`
  - Whitespace (" 5 ") → trim and accept if correct
- **Performance**: <100ms per validation
- **Risk Coverage**: REL-001

### Group 3: Performance Benchmarks (PERF-001 mitigation)

**1.M1-UNIT-013: Problem Generation Performance - Single**
- **Priority**: P0
- **Description**: Verify single problem generation meets <50ms target
- **Test**: Generate 1000 individual problems, measure each
- **Then**:
  - P50 (median): <20ms
  - P95 (95th percentile): <50ms
  - P99: <80ms (acceptable for edge cases)
  - No single generation >100ms
- **Operations Tested**: All 4 (addition, subtraction, multiplication, division)
- **Risk Coverage**: PERF-001

**1.M1-UNIT-014: Problem Generation Performance - Batch**
- **Priority**: P0
- **Description**: Verify batch generation performance
- **Test**: Generate 100 problems in batch
- **Then**:
  - Total time <5s (50ms average per problem)
  - Memory usage <20MB
  - No memory leaks (measure before/after)
- **Risk Coverage**: PERF-001

**1.M1-UNIT-015: Answer Validation Performance**
- **Priority**: P0
- **Description**: Verify validation meets <100ms target
- **Test**: Validate 1000 answers
- **Then**:
  - All validations <100ms
  - P95: <50ms
  - Division with remainder validation <100ms
- **Risk Coverage**: PERF-001, US-003 feedback timing

**1.M1-UNIT-016: Memory Usage - Session Data**
- **Priority**: P0
- **Description**: Verify session data memory within budget
- **Test**: Complete 100-problem session, measure memory
- **Then**:
  - Session data <20MB
  - No memory leaks over session
  - Garbage collection working (measure before/after)
- **Risk Coverage**: PERF-001

### Group 4: BNCC Competency Tagging

**1.M1-UNIT-017: BNCC Tagging - EF05MA03 (Division with Remainder)**
- **Priority**: P0
- **Description**: Verify correct BNCC code assignment for division with remainder
- **Test Cases**:
  - Problem "17 ÷ 5" (remainder 2) → `bnccCode: "EF05MA03"`
  - Problem "20 ÷ 5" (no remainder) → `bnccCode: "EF05MA06"` (or appropriate code, NOT EF05MA03)
- **Then**: Only non-zero remainder problems tagged EF05MA03
- **Risk Coverage**: DATA-002, BNCC compliance

**1.M1-UNIT-018: BNCC Tagging - EF04MA07 (Multiplication Problems)**
- **Priority**: P0
- **Description**: Verify correct BNCC code assignment for multiplication
- **Test Cases**:
  - Word problem "João tem 5 caixas com 8 maçãs. Quantas ao todo?" → `bnccCode: "EF04MA07"`
  - Pure calculation "5 × 8" → `bnccCode: "EF04MA09"` (or appropriate code, NOT EF04MA07 unless story clarified)
- **Then**: Only actual problems (not pure calculation) tagged EF04MA07
- **Risk Coverage**: DATA-002, BNCC compliance
- **NOTE**: This test depends on PM clarification of word problem scope in story

## Integration Tests (16 scenarios)

### Group 5: UI Component Integration

**1.M1-INT-001: Problem Display and Input Field**
- **Priority**: P0
- **Description**: Verify problem renders with accessible input
- **Given**: Module loaded with config
- **When**: First problem displayed
- **Then**:
  - Problem text visible (20px/700/Atkinson Hyperlegible font)
  - Input field present, focused, empty
  - Input type="number" for numeric answers
  - Label associated with input (aria-labelledby)
  - Progress indicator shows "Problema 1 de 30"
- **Risk Coverage**: A11Y-001, AC-1

**1.M1-INT-002: Progress Indicator Updates**
- **Priority**: P0
- **Description**: Verify progress updates throughout session
- **Given**: 30-problem session started
- **When**: Student completes problems 1, 2, 3... 30
- **Then**:
  - Progress bar fills (0% → 3.3% → 6.6% → ... → 100%)
  - Text updates ("Problema 1 de 30" → "Problema 2 de 30" → ...)
  - `aria-valuenow` attribute updates for screen readers
  - Visual progress consistent with actual completion
- **Risk Coverage**: AC-1, A11Y-001

**1.M1-INT-003: Timer Display (if configured)**
- **Priority**: P1
- **Description**: Verify timer countdown when enabled
- **Given**: Config with `timeLimit: 300` (5 minutes)
- **When**: Session starts
- **Then**:
  - Timer shows "05:00" and counts down
  - Timer updates every second
  - Timer accessible (aria-live region announces milestones)
  - Session ends when timer reaches 00:00
- **Risk Coverage**: AC-1, A11Y-001

**1.M1-INT-004: Pause Functionality**
- **Priority**: P1
- **Description**: Verify pause/resume session works
- **Given**: Session in progress (problem 15 of 30)
- **When**: Student clicks "Pausar"
- **Then**:
  - Session paused (timer stops if enabled)
  - UI shows "Pausado" state
  - "Retomar" button appears
  - Session data auto-saved to localStorage
  - When "Retomar" clicked, session continues from problem 15
- **Risk Coverage**: AC-1, REL-001

### Group 6: Feedback Integration (INT-001 risk mitigation)

**1.M1-INT-005: Correct Answer Feedback**
- **Priority**: P0
- **Description**: Verify feedback for correct answers
- **Given**: Problem "15 ÷ 3 = ?"
- **When**: Student submits "5" (correct)
- **Then**:
  - Feedback appears within 100ms
  - Visual: Green checkmark ✓ + subtle glow animation
  - Message: "Muito bem! 15 ÷ 3 = 5 porque 5 grupos de 3 fazem 15."
  - Audio: Optional pitched tone (if enabled)
  - Screen reader announces: "Correto! Muito bem!"
  - Automatic progression after 2s
- **Risk Coverage**: INT-001, US-003 integration, AC-2

**1.M1-INT-006: Incorrect Answer Feedback**
- **Priority**: P0
- **Description**: Verify feedback for incorrect answers
- **Given**: Problem "17 ÷ 5 = ?"
- **When**: Student submits "3" (incorrect, forgot remainder)
- **Then**:
  - Feedback appears within 100ms
  - Visual: Red X ✗ + gentle shake animation
  - Correct answer shown: "17 ÷ 5 = 3 resto 2"
  - Message: "Vamos pensar juntos: quando dividimos, precisamos ver se sobra algo. 17 ÷ 5 dá 3 com resto 2."
  - Screen reader announces: "Não é bem assim. A resposta correta é 3 resto 2."
  - Automatic progression after 2s
- **Risk Coverage**: INT-001, US-003 integration, AC-2, EDU-001

**1.M1-INT-007: Feedback Timing Performance**
- **Priority**: P0
- **Description**: Verify feedback meets <100ms timing requirement (US-003 spec)
- **Test**: Submit 100 answers (mix of correct/incorrect)
- **Then**:
  - All feedback appears <100ms after submit
  - P95: <50ms
  - No blocking of UI during feedback
  - Animation doesn't delay next problem
- **Risk Coverage**: INT-001, PERF-001

**1.M1-INT-008: Feedback Accessibility**
- **Priority**: P0
- **Description**: Verify feedback accessible to all students
- **Then**:
  - Screen reader announces feedback immediately (aria-live="assertive")
  - Keyboard users can dismiss and continue (Enter key)
  - Color + icon feedback (not color alone for colorblind)
  - Animation respects prefers-reduced-motion
  - Audio feedback optional (user preference)
- **Risk Coverage**: A11Y-001, INT-001

### Group 7: Data Flow and Analytics

**1.M1-INT-009: Session Data Collection**
- **Priority**: P0
- **Description**: Verify session data accurately captured
- **Given**: Complete 30-problem session (20 correct, 10 incorrect)
- **When**: Session ends
- **Then**: SessionData contains:
  ```javascript
  {
    moduleType: "BateriaRápida",
    sessionData: {
      totalProblems: 30,
      correctAnswers: 20,
      incorrectAnswers: 10,
      timeSpent: 893, // seconds
      averageTimePerProblem: 29.8,
      conceptsAttempted: ["division_basic", "division_remainder"],
      errorPatterns: ["remainder_ignored"],
      finalScore: 0.67
    }
  }
  ```
- **Risk Coverage**: AC-3, DATA-002

**1.M1-INT-010: BNCC Progress Tracking**
- **Priority**: P0
- **Description**: Verify BNCC competency progress accurately calculated
- **Given**: Session with 15 division-with-remainder problems (12 correct)
- **When**: Session completes
- **Then**: `bnccProgress` contains:
  ```javascript
  {
    "EF05MA03": {
      attempts: 15,
      correct: 12,
      mastery: 0.80, // 12/15
      errorPatterns: ["remainder_ignored"]
    }
  }
  ```
- **Risk Coverage**: DATA-002, BNCC compliance

**1.M1-INT-011: Error Pattern Detection**
- **Priority**: P1
- **Description**: Verify common errors detected and tracked
- **Test Cases**:
  - Student answers "3" for "17 ÷ 5" (expected: 3 resto 2) → errorPattern: "remainder_ignored"
  - Student answers "2.4" for "12 ÷ 5" (expected: 2 resto 2) → errorPattern: "decimal_instead_of_remainder"
  - Student answers "5" for "15 ÷ 3" → NO error pattern (correct)
- **Then**: `errorPatterns` array accurately reflects detected patterns
- **Risk Coverage**: DATA-002, EDU-001

**1.M1-INT-012: Data Persistence to Supabase**
- **Priority**: P0
- **Description**: Verify session data saved to database
- **Given**: Completed session
- **When**: Session finishes
- **Then**:
  - Data sent to Supabase `sessions` table
  - Student ID, activity ID, timestamp included
  - SessionData JSON stored correctly
  - BNCC progress data saved
  - Teacher can view in analytics dashboard (future US-010)
- **Risk Coverage**: AC-3, REL-001

### Group 8: Configuration Handling

**1.M1-INT-013: Valid Configuration Loading**
- **Priority**: P0
- **Description**: Verify module loads with valid configuration
- **Given**: Valid JSON config (example from story)
- **When**: ModuleRuntime loads BateriaRápida
- **Then**:
  - Module initializes successfully
  - Configuration applied (operationType, numberRange, quantity)
  - No errors or warnings
  - UI reflects configuration (e.g., shows 30 problems if quantity=30)
- **Risk Coverage**: US-001 integration, CONFIG-001

**1.M1-INT-014: Invalid Configuration Rejection**
- **Priority**: P1
- **Description**: Verify invalid configs rejected gracefully
- **Test Cases**:
  - `min > max` in numberRange → Error: "Range inválido: min deve ser menor que max"
  - `quantity: 0` → Error: "Quantidade deve ser maior que zero"
  - `operationType: "exponentiation"` → Error: "Operação não suportada. Use: addition, subtraction, multiplication, division"
  - `timeLimit: -10` → Error: "Limite de tempo deve ser positivo ou null"
- **Then**:
  - Clear error message shown to teacher
  - Module doesn't load (graceful failure)
  - Error logged for debugging
- **Risk Coverage**: CONFIG-001

**1.M1-INT-015: Estimated Duration Accuracy**
- **Priority**: P1
- **Description**: Verify estimated duration matches actual usage
- **Given**: Config with `estimatedDuration: 15` (minutes)
- **When**: Students complete sessions (sample size: 20 students)
- **Then**:
  - Average actual duration: 12-18 minutes (±20% tolerance)
  - P95 duration: <20 minutes
  - Duration tracked in analytics
- **Risk Coverage**: AC-3, US-002 integration

**1.M1-INT-016: Module Integration with Activity Orchestrator**
- **Priority**: P1
- **Description**: Verify module works in multi-module activity (US-002)
- **Given**: Activity with EstadoJeremias → BateriaRápida → AutoAvaliação
- **When**: Student completes BateriaRápida
- **Then**:
  - SessionData passed to next module (AutoAvaliação)
  - Fields passed: `score`, `conceptsAttempted` (per dataFlow config)
  - Activity progress updates (2/3 complete)
  - Transition smooth (<1s)
- **Risk Coverage**: US-002 integration

## E2E Tests (8 scenarios)

### Group 9: Complete Student Journeys

**1.M1-E2E-001: Happy Path - Complete 30-Problem Session**
- **Priority**: P0
- **Description**: End-to-end student experience, all correct
- **Steps**:
  1. Student navigates to activity containing BateriaRápida
  2. Module loads with 30 division problems
  3. Student answers all 30 correctly
  4. Each answer receives positive feedback
  5. Progress bar fills to 100%
  6. Final score displayed: "30/30 (100%)"
  7. Encouraging message: "Parabéns! Você dominou divisão!"
  8. Data saved to Supabase
  9. Module transitions to next in activity
- **Verification**:
  - Total time <15 minutes (typical student pace)
  - All transitions smooth
  - Data integrity verified in database
- **Risk Coverage**: AC-1, AC-2, AC-3

**1.M1-E2E-002: Realistic Path - Mix of Correct/Incorrect**
- **Priority**: P0
- **Description**: Student makes mistakes, receives feedback
- **Steps**:
  1. Student starts 30-problem session
  2. Answers 20 correct, 10 incorrect
  3. Each incorrect answer shows:
     - Correct answer
     - Explanation
     - Encouragement to continue
  4. Student completes all 30 despite errors
  5. Final score: "20/30 (67%)"
  6. Message: "Bom trabalho! Continue praticando divisão."
  7. Error patterns detected (e.g., "remainder_ignored")
  8. Data saved with error analysis
- **Verification**:
  - Student not discouraged by incorrect feedback (observe engagement)
  - Error patterns accurately captured
- **Risk Coverage**: AC-2, EDU-001, UX-001

**1.M1-E2E-003: Session with Timer (Time Pressure)**
- **Priority**: P1
- **Description**: Student completes session with time limit
- **Given**: Config with `timeLimit: 300` (5 minutes for 30 problems)
- **Steps**:
  1. Student starts session, timer begins countdown
  2. Student answers problems rapidly (10s each)
  3. Completes 25 problems in 4:30 (remaining: 00:30)
  4. Timer shows warning at 1 minute remaining
  5. Student completes 30th problem at 04:50 (10s remaining)
  6. Session ends, score shown
- **Then**:
  - Timer countdown accurate
  - No jarring transitions as time runs low
  - Student can complete without panic
- **Risk Coverage**: AC-1, UX-001, A11Y-001

**1.M1-E2E-004: Pause and Resume Session**
- **Priority**: P1
- **Description**: Student pauses mid-session and resumes later
- **Steps**:
  1. Student completes 15 of 30 problems
  2. Clicks "Pausar"
  3. Session state saved to localStorage
  4. Student closes browser (or navigates away)
  5. Student returns 1 hour later
  6. Module shows "Continuar sessão anterior?" prompt
  7. Student clicks "Continuar"
  8. Session resumes at problem 16
  9. Student completes remaining 15 problems
  10. Final score includes all 30 problems
- **Verification**:
  - No data loss
  - Progress accurate after resume
- **Risk Coverage**: AC-1, REL-001

**1.M1-E2E-005: Accessibility - Keyboard-Only Navigation**
- **Priority**: P0
- **Description**: Student completes session using only keyboard
- **Steps**:
  1. Student navigates to module (Tab key)
  2. Problem announced by screen reader
  3. Input field auto-focused (cursor in field)
  4. Student types answer, presses Enter
  5. Feedback announced by screen reader
  6. After 2s, focus moves to next problem input
  7. Student completes all 30 problems via keyboard
  8. Final score announced
- **Then**:
  - No need for mouse at any point
  - All interactive elements reachable via Tab
  - Enter key works for submission
  - Screen reader announces all critical info
- **Risk Coverage**: A11Y-001, AC-2

**1.M1-E2E-006: Accessibility - Screen Reader (NVDA)**
- **Priority**: P0
- **Description**: Blind student completes session with NVDA
- **Steps**:
  1. Start NVDA screen reader
  2. Navigate to BateriaRápida module
  3. NVDA announces: "Módulo BateriaRápida. Problema 1 de 30. Seventeen divided by five equals question mark. Enter your answer."
  4. Student types answer "3 resto 2"
  5. NVDA announces: "Correto! Muito bem! 17 divided by 5 equals 3 remainder 2."
  6. NVDA announces: "Problema 2 de 30. Twenty three divided by seven equals question mark."
  7. Student completes session entirely via audio
- **Verification**:
  - All problems clearly announced
  - Feedback immediately announced
  - Progress updates announced
  - Math notation readable ("divided by" not "÷ symbol")
- **Risk Coverage**: A11Y-001, AC-2

**1.M1-E2E-007: Low-End Device Performance**
- **Priority**: P0
- **Description**: Session runs smoothly on 2018 Chromebook
- **Setup**: 2018 Chromebook (Celeron N3350, 4GB RAM, Chrome OS)
- **Steps**:
  1. Load BateriaRápida module
  2. Complete 30-problem session
  3. Monitor performance throughout
- **Then**:
  - Module loads <3s
  - Problem generation <50ms (measured in DevTools)
  - Transitions smooth (no janky animations)
  - Memory usage <50MB total
  - No lag or stuttering
- **Risk Coverage**: PERF-001

**1.M1-E2E-008: Network Failure Recovery**
- **Priority**: P1
- **Description**: Student completes session offline, syncs later
- **Steps**:
  1. Student starts session with network connected
  2. At problem 10, network disconnects (simulate)
  3. Student continues, completes all 30 problems
  4. Data saved to localStorage (Supabase sync queued)
  5. Student sees "Salvando offline..." indicator
  6. Network reconnects
  7. Queued data automatically syncs to Supabase
  8. Success indicator shown
- **Then**:
  - No data loss despite network failure
  - Student experience uninterrupted
- **Risk Coverage**: REL-001

## User Acceptance Tests (6 scenarios)

### Group 10: Pedagogical Validation

**1.M1-UAT-001: Problem Quality Review (PM Validation)**
- **Priority**: P0 (BLOCKER)
- **Description**: Pedagogy expert validates generated problems
- **Process**:
  1. Generate 100 problems per operation (400 total)
  2. PM reviews for:
     - Age-appropriateness (9-12 years)
     - Mathematical correctness
     - BNCC alignment (EF05MA03, EF04MA07)
     - Cultural appropriateness (Brazilian context)
     - Problem variety (not repetitive)
  3. PM provides written approval or requests changes
- **Acceptance Criteria**:
  - PM approves 95%+ of problems
  - Any flagged problems documented and algorithm adjusted
  - Written sign-off from PM before release
- **Risk Coverage**: EDU-001 (CRITICAL), BNCC compliance

**1.M1-UAT-002: User Testing with 9-Year-Olds**
- **Priority**: P0 (BLOCKER)
- **Description**: Youngest target users can complete successfully
- **Participants**: 2 students, age 9
- **Tasks**:
  1. Complete 10-problem session (mix of operations)
  2. Observe: time per problem, frustration, confusion
  3. Post-test interview: "Was this easy, hard, or just right?"
- **Success Criteria**:
  - Completion rate: 100% (both students finish)
  - Average time per problem: 30-60s (acceptable range)
  - Frustration indicators: <20% of problems (verbal complaints, sighs)
  - Post-test feedback: "just right" or "easy" (not "hard")
- **Risk Coverage**: EDU-001, UX-001

**1.M1-UAT-003: User Testing with 12-Year-Olds**
- **Priority**: P0 (BLOCKER)
- **Description**: Oldest target users find problems engaging, not babyish
- **Participants**: 2 students, age 12
- **Tasks**: Same as UAT-002
- **Success Criteria**:
  - Completion rate: 100%
  - Average time per problem: 15-30s (faster than 9-year-olds)
  - Engagement: Students don't report boredom
  - Post-test feedback: Problems are "good practice" not "too easy"
- **Risk Coverage**: EDU-001, UX-001

**1.M1-UAT-004: User Testing with Struggling Learner**
- **Priority**: P0
- **Description**: Student with math difficulties can succeed with support
- **Participants**: 1-2 students identified by teacher as struggling with math
- **Tasks**:
  1. Complete 10-problem session (flat difficulty, easier range)
  2. Observe: Does feedback help? Does student give up?
  3. Note: Error patterns, time needed, emotional response
- **Success Criteria**:
  - Student completes session (doesn't abandon)
  - Feedback perceived as helpful, not punitive
  - At least 50% correct (with support from feedback)
  - Student willing to try again ("I want to do more")
- **Risk Coverage**: EDU-001, UX-001, INT-001 (feedback quality)

**1.M1-UAT-005: Accessibility Testing with Diverse Learners**
- **Priority**: P0
- **Description**: Students with disabilities can access and use module
- **Participants**: 2-3 students with:
  - Visual impairment (screen reader user)
  - Dyslexia (test OpenDyslexic font option)
  - Motor impairment (keyboard-only navigation)
- **Tasks**: Complete 5-problem session with assistive tech
- **Success Criteria**:
  - Screen reader user completes independently
  - Dyslexic student finds font helpful (subjective report)
  - Keyboard-only user navigates without frustration
  - All students report feeling included
- **Risk Coverage**: A11Y-001 (CRITICAL)

**1.M1-UAT-006: BNCC Alignment Verification**
- **Priority**: P0
- **Description**: Verify problems actually meet BNCC competency criteria
- **Process**:
  1. Select 20 division-with-remainder problems
  2. PM maps each to BNCC EF05MA03 criteria
  3. Verify: "Resolver problemas envolvendo divisão de números naturais, com resto diferente de zero"
  4. Check if problems develop understanding of remainder concept
- **Success Criteria**:
  - 100% of remainder problems align with EF05MA03
  - Clean division problems NOT tagged as EF05MA03
  - PM confirms problems develop targeted competency
- **Risk Coverage**: DATA-002, BNCC compliance

## Test Data and Fixtures

### Sample Configurations

**Config 1: Easy Division Practice (9-year-olds)**
```json
{
  "moduleType": "BateriaRápida",
  "config": {
    "operationType": "division",
    "numberRange": { "min": 10, "max": 50 },
    "quantity": 20,
    "timeLimit": null,
    "allowCalculator": false,
    "showProgress": true,
    "difficultyCurve": "flat"
  },
  "metadata": {
    "estimatedDuration": 10,
    "bnccCodes": ["EF05MA03"],
    "targetAge": [9, 10]
  }
}
```

**Config 2: Mixed Operations, Ascending Difficulty (11-12-year-olds)**
```json
{
  "moduleType": "BateriaRápida",
  "config": {
    "operationType": "division", // Run 4 times, once per operation
    "numberRange": { "min": 10, "max": 100 },
    "quantity": 30,
    "timeLimit": 600, // 10 minutes
    "allowCalculator": false,
    "showProgress": true,
    "difficultyCurve": "ascending"
  },
  "metadata": {
    "estimatedDuration": 15,
    "bnccCodes": ["EF05MA03", "EF04MA07"],
    "targetAge": [11, 12]
  }
}
```

### Expected Problem Examples

**Division with Remainder (EF05MA03)**
```javascript
[
  { dividend: 17, divisor: 5, quotient: 3, remainder: 2 },
  { dividend: 23, divisor: 7, quotient: 3, remainder: 2 },
  { dividend: 31, divisor: 4, quotient: 7, remainder: 3 },
  { dividend: 47, divisor: 6, quotient: 7, remainder: 5 },
  { dividend: 53, divisor: 8, quotient: 6, remainder: 5 }
]
```

**Multiplication (Age-Appropriate)**
```javascript
[
  { factor1: 5, factor2: 8, result: 40 },  // Multiplication tables
  { factor1: 7, factor2: 6, result: 42 },
  { factor1: 9, factor2: 4, result: 36 },
  { factor1: 12, factor2: 3, result: 36 },
  { factor1: 8, factor2: 7, result: 56 }
]
```

## Test Environment Requirements

### Hardware
- **Development**: Modern laptop (8GB+ RAM, recent CPU)
- **Low-End Testing**: 2018 Chromebook (Celeron N3350, 4GB RAM) or equivalent
- **Real School Hardware**: Actual devices used in partner schools

### Software
- **Browser**: Chrome 100+, Edge 100+, Firefox 100+
- **Screen Readers**: NVDA (Windows), JAWS (comprehensive testing), VoiceOver (iOS)
- **Performance Tools**: Chrome DevTools Performance profiling
- **Accessibility Tools**: axe DevTools, Lighthouse

### Test Data
- **Database**: Supabase test instance (isolated from production)
- **Student Accounts**: Test accounts for different age groups
- **Problem Sets**: Pre-generated sets for reproducibility

## Test Automation Strategy

### Unit Tests: 100% Automated (Vitest)
- Run on every commit (CI/CD)
- Fast (<5s total)
- Deterministic (same input → same output)

### Integration Tests: 80% Automated (Playwright)
- Run on every PR
- UI interaction tests
- Performance benchmarks
- Accessibility checks (axe-core)

### E2E Tests: 50% Automated (Playwright)
- Critical paths automated (E2E-001, E2E-002, E2E-005)
- Real device testing manual (E2E-007)
- Network failure automated (E2E-008)

### UAT: 100% Manual (Human Testing)
- User testing requires real students
- PM review requires pedagogical expertise
- BNCC alignment requires expert judgment

## Test Execution Schedule

### Sprint 1: Unit Tests (Week 1-2)
- Implement all 18 unit tests
- Achieve 90%+ code coverage
- Performance benchmarks passing

### Sprint 2: Integration Tests (Week 3-4)
- UI component integration (INT-001 through INT-004)
- Feedback integration (INT-005 through INT-008)
- Data flow and analytics (INT-009 through INT-012)

### Sprint 3: E2E and User Testing (Week 5-6)
- Automated E2E tests (E2E-001, E2E-002, E2E-005, E2E-008)
- Manual device testing (E2E-007)
- Recruit participants for UAT

### Sprint 4: UAT and Refinement (Week 7-8)
- User testing with students (UAT-002 through UAT-005)
- PM problem review (UAT-001)
- BNCC alignment verification (UAT-006)
- Iterate on feedback

## Success Criteria

### MVP Release Gate
All P0 tests must pass:
- [ ] 18 unit tests passing
- [ ] 12 integration tests passing (INT-001 through INT-012)
- [ ] 4 E2E tests passing (E2E-001, E2E-002, E2E-005, E2E-006)
- [ ] 6 UAT completed with positive results
- [ ] Performance targets met (<50ms, <20MB, <1s transitions)
- [ ] WCAG AA compliance verified (axe-core + manual)
- [ ] PM approval of problem quality
- [ ] User testing completion rate >85%

### Post-MVP Optimization
P1 and P2 tests provide optimization targets:
- Difficulty curve refinement based on user data
- A/B testing different feedback styles
- Configuration edge case handling
- Advanced analytics features

## Risk Coverage Matrix

| Risk ID | Test Scenarios | Priority | Status |
|---------|----------------|----------|--------|
| EDU-001 | UNIT-001 through UNIT-008, UAT-001 through UAT-004 | P0 | Designed |
| PERF-001 | UNIT-013 through UNIT-016, E2E-007 | P0 | Designed |
| A11Y-001 | INT-002, INT-008, E2E-005, E2E-006, UAT-005 | P0 | Designed |
| INT-001 | INT-005 through INT-008 | P0 | Designed |
| DATA-002 | UNIT-017, UNIT-018, INT-010, INT-011, UAT-006 | P0 | Designed |
| UX-001 | UAT-002 through UAT-004 | P0 | Designed |
| REL-001 | E2E-004, E2E-008 | P1 | Designed |
| CONFIG-001 | INT-013, INT-014 | P1 | Designed |

**Coverage**: 100% of identified risks have explicit test scenarios

---

**Test Design Completed**: 48 comprehensive scenarios covering all acceptance criteria, DoD requirements, NFR targets, and risk mitigations.

**Next Steps**:
1. PM review of problem generation test data (UAT-001 blocker)
2. Implement unit tests during development Sprint 1
3. Recruit user testing participants (minimum 10 students)
4. Set up accessibility testing infrastructure (axe-core, NVDA)

**Questions for Team**:
- Is word problem generation in scope for MVP? (Affects EF04MA07 tests)
- What is minimum target device specification? (Using 2018 Chromebook assumption)
- Timeline for user testing recruitment? (2 weeks lead time recommended)
